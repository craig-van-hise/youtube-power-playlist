<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steve Gadd Performance Archive</title>
    <!-- Modern Styling with Bootstrap -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
    <!-- DataTables CSS with Bootstrap 5 integration -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.8/css/dataTables.bootstrap5.css">
    <!-- DataTables Buttons extension CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/3.0.2/css/buttons.bootstrap5.css">
    <style>
        body {
            padding: 2rem;
        }
        .dt-buttons .btn-group {
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <h1 class="mb-4">Steve Gadd Performance Archive</h1>

    <!-- The table will be populated here -->
    <table id="archiveTable" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <!-- New Column Order -->
                <th>Watch</th>
                <th>Title</th>
                <th>Performance Date</th>
                <th>Upload Date</th>
                <th>Description</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be loaded via JavaScript -->
        </tbody>
    </table>
</div>

<!-- Modal for column visibility -->
<div class="modal fade" id="columnsModal" tabindex="-1" aria-labelledby="columnsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="columnsModalLabel">Customize Columns</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="column-toggles">
        <!-- Checkboxes will be inserted here by JavaScript -->
      </div>
    </div>
  </div>
</div>


<!-- Core Libraries: jQuery and Bootstrap -->
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<!-- DataTables Core JS -->
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.js"></script>
<script src="https://cdn.datatables.net/2.0.8/js/dataTables.bootstrap5.js"></script>

<!-- DataTables Buttons extension JS -->
<script src="https://cdn.datatables.net/buttons/3.0.2/js/dataTables.buttons.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.bootstrap5.js"></script>
<script src="https://cdn.datatables.net/buttons/3.0.2/js/buttons.colVis.js"></script>

<script>
$(document).ready(function() {
    // Fetch data and initialize the DataTable
    $.getJSON('data.json', function(data) {
        const table = $('#archiveTable').DataTable({
            data: data,
            // Define the columns in the new order
            columns: [
                {
                    // 1. "Watch" button - now the first column
                    data: 'url',
                    orderable: false, // Don't allow sorting on this column
                    render: function(data, type, row) {
                        return `<a href="${data}" target="_blank" class="btn btn-primary btn-sm">Watch</a>`;
                    }
                },
                // 2. Title
                { data: 'title' },
                // 3. Performance Date
                { data: 'performance_date' },
                // 4. Upload Date (mapped from 'upload_date')
                { data: 'upload_date' },
                // 5. Description (using 'context' as source)
                { data: 'context' }
            ],
            // Add the "Customize Columns" button
            dom: 'Bfrtip', // This is required to show the Buttons
            buttons: [
                {
                    text: 'üëÅÔ∏è Customize Columns',
                    className: 'btn btn-outline-secondary',
                    action: function ( e, dt, node, config ) {
                        // Clear previous toggles
                        $('#column-toggles').empty();
                        
                        // Create a checkbox for each column
                        dt.columns().every(function () {
                            const column = this;
                            const title = $(column.header()).html();
                            
                            // Don't create a toggle for the "Watch" button column
                            if (column.index() === 0) return;

                            const checkbox = $(`
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" ${column.visible() ? 'checked' : ''}>
                                    <label class="form-check-label">${title}</label>
                                </div>
                            `);

                            checkbox.find('input').on('click', function () {
                                column.visible(!column.visible());
                            });

                            $('#column-toggles').append(checkbox);
                        });

                        // Open the modal
                        const modal = new bootstrap.Modal(document.getElementById('columnsModal'));
                        modal.show();
                    }
                }
            ],
            // Make the table responsive
            responsive: true,
            // Set default ordering (e.g., by Performance Date descending)
            order: [[2, 'desc']]
        });
    });
});
</script>

</body>
</html>